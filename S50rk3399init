#!/bin/sh
#
# Start 3399 linux service/window....
#

case "$1" in
	start)
		export LC_ALL='zh_CN.utf8'
		export QT_QPA_EVDEV_TOUCHSCREEN_PARAMETERS=/dev/input/event0
		export QT_QPA_EVDEV_KEYBOARD_PARAMETERS=/dev/input/event1:/dev/input/event2

		#for kmssink
		export QT_GSTREAMER_WINDOW_VIDEOSINK=kmssink

		#for waylandsink
		#export QT_GSTREAMER_WINDOW_VIDEOSINK=waylandsink

		#Resize root filesystem to fit available disk space
		resize2fs /dev/mmcblk1p6

		# Mount debugfs
		mount -t debugfs none /sys/kernel/debug

		# bluetooth
		rkbt  /etc/bluetooth/bcm4354a1.hcd /dev/ttyS0 &

		# music
		/usr/bin/audioservice &

		#Power manager
		/usr/bin/power_manager_service &

		#for QLauncher wayland
		#mkdir -p /tmp/.xdg &&  chmod 0700 /tmp/.xdg
		#export XDG_RUNTIME_DIR=/tmp/.xdg
		#weston --tty=2 --idle-time=0&
		#sleep 1
		#/usr/local/QLauncher/QLauncher -platform wayland -plugin EvdevTouch -plugin EvdevKeyboard &

		#for Carmachine eglfs
		#/usr/bin/Carmachine -platform eglfs -plugin EvdevTouch:/dev/input/event0 &

		#for QLauncher eglfs
		/usr/local/QLauncher/QLauncher -platform EGLFS -plugin EvdevTouch -plugin EvdevKeyboard &

		echo performance > /sys/class/devfreq/ff9a0000.gpu/governor
		echo performance > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
		;;
	stop)
		killall CarMachine
		killall weston
		printf "stop finished"
        ;;
	*)
        echo "Usage: $0 {start|stop}"
        exit 1
        ;;
esac
exit 0

